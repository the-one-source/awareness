<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Spectrum of Awareness</title>
<style>
  :root{
    --panel-width:760px;
    --accent:#666440;
    --bg:#f5f7fa;
    --card:#ffffff;
    --muted:#666;
    --text:#111;
  }
  html,body{height:100%;margin:0;background:var(--bg);font-family:-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text);}
  .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:28px;}
  .panel{width:min(96%,var(--panel-width));max-width:var(--panel-width);background:var(--card);border-radius:14px;box-shadow:0 10px 30px rgba(20,20,30,0.06);padding:34px;box-sizing:border-box;text-align:center;}
  h1{margin:0 0 18px 0;font-weight:400;color:#444;font-size:22px;}
  .row{display:flex;justify-content:center;gap:12px;align-items:center;margin-bottom:20px;}
  select{padding:8px 12px;font-size:15px;border-radius:8px;border:1px solid #e6e6e6;background:white;}
  p.lead{margin:0 0 18px 0;color:#666;font-size:15px;line-height:1.45;}
  .fixed-slider-wrap{width:100%;display:flex;flex-direction:column;align-items:center;gap:8px;margin:18px 0 8px 0;}
  .fixed-track{width:92%;max-width:680px;}
  input[type="range"]{-webkit-appearance:none;width:100%;height:12px;border-radius:10px;background:#e6e6e6;outline:none;margin:0;padding:0;}
  input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:34px;height:18px;border-radius:9px;background:var(--accent);box-shadow:0 6px 18px rgba(102,100,64,0.24);border:2px solid white;margin-top:-3px;cursor:pointer;}
  input[type="range"]::-moz-range-thumb{width:34px;height:18px;border-radius:9px;background:var(--accent);box-shadow:0 6px 18px rgba(102,100,64,0.24);border:2px solid white;cursor:pointer;}
  .slider-labels{width:92%;max-width:680px;display:flex;justify-content:space-between;color:var(--muted);font-size:13px;margin-top:6px;user-select:none;}
  .btn{display:inline-block;padding:12px 28px;border-radius:28px;background:var(--accent);color:white;border:none;font-size:15px;cursor:pointer;box-shadow:0 6px 18px rgba(102,100,64,0.18);margin-top:18px;}
  .btn:active{transform:translateY(1px);}
  .question-container{width:100%;}
  .result-grid{margin-top:12px;color:#333;font-size:15px;display:flex;gap:12px;justify-content:space-between;align-items:center;}
  .result-stage{font-weight:700;flex:1;padding:10px;background:#fbfbfb;border-radius:10px;}
  .result-score{font-size:18px;color:#222;margin-top:8px;font-weight:600;}
  .hidden{display:none;}
  :root[dir="rtl"] .panel{direction:rtl;}
  :root[dir="rtl"] .slider-labels{direction:rtl;}
  #questionText{font-size:18px;line-height:1.45;margin:6px 0 14px 0;text-align:center;word-break:break-word;}
  footer.note{margin-top:14px;color:#666;font-size:13px;}
  @media (max-width:520px){ .panel{padding:20px;} #questionText{font-size:16px;} .btn{padding:10px 20px;} }
</style>
</head>
<body>
<div class="wrap">
  <div class="panel" id="panel">

    <!-- Title (Landing & Result only) -->
    <h1 id="pageTitle">Spectrum of Awareness</h1>

    <!-- Language selector (Landing only) -->
    <div class="row" id="langRow">
      <select id="langSelect" aria-label="Language">
        <option value="en">English</option>
        <option value="de">Deutsch</option>
        <option value="fa">فارسی</option>
      </select>
    </div>

    <!-- Landing pane -->
    <div id="landingPane">
      <p class="lead" id="landingText">This is a reflection of my inner consciousness called Spectrum of Awareness. I am answering a series of statements using the slider to indicate my agreement.</p>

      <div class="fixed-slider-wrap">
        <div class="fixed-track">
          <input id="landingSlider" type="range" min="0" max="10" value="5" />
        </div>
        <div class="slider-labels" id="landingLabels">
          <span id="lblLeft">Disagree</span>
          <span id="lblMid">Uncertain</span>
          <span id="lblRight">Agree</span>
        </div>
      </div>

      <button id="startBtn" class="btn">Start</button>
    </div>

    <!-- Questionnaire pane (NO title, NO language selector) -->
    <div id="questionPane" class="hidden" aria-live="polite">
      <div id="questionText" role="heading" aria-level="2"></div>

      <div class="fixed-slider-wrap">
        <div class="fixed-track">
          <input id="questionSlider" type="range" min="0" max="10" value="5" />
        </div>
        <div class="slider-labels" id="questionLabels">
          <span id="qLblLeft">Disagree</span>
          <span id="qLblMid">Uncertain</span>
          <span id="qLblRight">Agree</span>
        </div>
      </div>

      <button id="nextBtn" class="btn">Next</button>
    </div>

    <!-- Result pane (Title visible, no language selector) -->
    <div id="resultPane" class="hidden">
      <div class="result-grid" aria-hidden="false">
        <div class="result-stage" id="stageI"><div>Stage I</div><div class="result-score" id="scoreI">0.0</div></div>
        <div class="result-stage" id="stageII"><div>Stage II</div><div class="result-score" id="scoreII">0.0</div></div>
        <div class="result-stage" id="stageIII"><div>Stage III</div><div class="result-score" id="scoreIII">0.0</div></div>
      </div>

      <div id="resultText" style="margin-top:18px;color:#333;font-size:15px;"></div>

      <div style="margin-top:18px;">
        <button id="restartBtn" class="btn">Restart</button>
      </div>
    </div>

    <footer class="note" id="footerNote" aria-hidden="true"></footer>
  </div>
</div>

<script>
/* ------------------------------------------------------------------
   QUESTIONS: each object has 'stage' (1/2/3) and localized text fields:
   en, de, fa
   ------------------------------------------------------------------ */
const QUESTIONS = [
  /* Life experience */
  {stage:1, en:"Life happens to me.", de:"Das Leben passiert mir.", fa:"زندگی برای من اتفاق می‌افتد."},
  {stage:2, en:"Life happens through me.", de:"Das Leben passiert durch mich.", fa:"زندگی از طریق من اتفاق می‌افتد."},
  {stage:3, en:"Life happens as me.", de:"Das Leben passiert als ich.", fa:"زندگی همان من است که رخ می‌دهد."},

  /* Fairness / Perception */
  {stage:1, en:"I feel life is unfair or against me.", de:"Ich fühle, das Leben ist unfair oder gegen mich.", fa:"من احساس می‌کنم زندگی ناعادلانه است یا علیه من است."},
  {stage:2, en:"I notice patterns repeating and wonder why.", de:"Ich bemerke sich wiederholende Muster und frage mich warum.", fa:"من الگوهای تکراری را مشاهده می‌کنم و می‌پرسم چرا."},
  {stage:3, en:"I see all as one flow of consciousness.", de:"Ich sehe alles als einen Fluss des Bewusstseins.", fa:"من همه چیز را به‌عنوان یک جریان واحد آگاهی می‌بینم."},

  /* Victimhood / Source */
  {stage:1, en:"I am the victim of life.", de:"Ich bin das Opfer des Lebens.", fa:"من قربانی زندگی هستم."},
  {stage:2, en:"I am connected to a source (higher self, God).", de:"Ich bin mit einer Quelle (höheres Selbst, Gott) verbunden.", fa:"من به یک منبع (خود برتر، خدا) متصل هستم."},
  {stage:3, en:"I am the only source; God is a concept within me.", de:"Ich bin die einzige Quelle; Gott ist ein Konzept in mir.", fa:"من تنها منبع هستم؛ خدا مفهومی درون من است."},

  /* Validation */
  {stage:1, en:"I need validation to feel seen.", de:"Ich brauche Bestätigung, um gesehen zu werden.", fa:"من برای دیده شدن به تأیید نیاز دارم."},
  {stage:2, en:"I am validated and seen.", de:"Ich bin bestätigt und gesehen.", fa:"من تأیید و دیده شده‌ام."},
  {stage:3, en:"I am the only validation.", de:"Ich bin die einzige Bestätigung.", fa:"من تنها تأیید هستم."},

  /* Blame / Responsibility */
  {stage:1, en:"I blame society for everything I experience.", de:"Ich gebe der Gesellschaft die Schuld für alles, was ich erlebe.", fa:"من جامعه را برای همه چیز سرزنش می‌کنم."},
  {stage:2, en:"I blame myself for what I experience.", de:"Ich gebe mir selbst die Schuld für das, was ich erlebe.", fa:"من خودم را برای تجربه‌هایم سرزنش می‌کنم."},
  {stage:3, en:"I blame no one; all arises from me.", de:"Ich gebe niemandem die Schuld; alles entsteht aus mir.", fa:"من کسی را سرزنش نمی‌کنم؛ همه چیز از من برمی‌خیزد."},

  /* Disconnection / Flow */
  {stage:1, en:"I feel disconnected or unseen.", de:"Ich fühle mich getrennt oder ungesehen.", fa:"من احساس جدایی یا نادیده گرفته شدن می‌کنم."},
  {stage:2, en:"I feel glimpses of unity and flow.", de:"Ich spüre Momente der Einheit und des Flusses.", fa:"من لحظاتی از وحدت و جریان را تجربه می‌کنم."},
  {stage:3, en:"I live without striving; I am being.", de:"Ich lebe ohne Anstrengung; ich bin.", fa:"من بدون تلاش زندگی می‌کنم؛ من هستم."},

  /* Creation / Questioning */
  {stage:1, en:"I was created.", de:"Ich wurde erschaffen.", fa:"من خلق شده‌ام."},
  {stage:2, en:"I am questioning creation.", de:"Ich hinterfrage die Schöpfung.", fa:"من در مورد خلقت سؤال می‌کنم."},
  {stage:3, en:"I am the only creator.", de:"Ich bin der einzige Schöpfer.", fa:"من تنها خالق هستم."},

  /* External presence */
  {stage:1, en:"There is someone or something out there.", de:"Da ist jemand oder etwas da draußen.", fa:"کسی یا چیزی در بیرون وجود دارد."},
  {stage:2, en:"Is there anyone out there?", de:"Gibt es jemanden da draußen?", fa:"آیا کسی در بیرون هست؟"},
  {stage:3, en:"There is no one; only I experience myself.", de:"Es ist niemand da; nur ich erlebe mich selbst.", fa:"هیچ‌کس نیست؛ تنها من خودم را تجربه می‌کنم."},

  /* Walls / Obstacles */
  {stage:1, en:"Someone has built the wall.", de:"Jemand hat die Mauer gebaut.", fa:"کسی دیوار را ساخته است."},
  {stage:2, en:"I am a brick in the wall.", de:"Ich bin ein Ziegel in der Mauer.", fa:"من یک آجر در دیوار هستم."},
  {stage:3, en:"I am the wall, shaping it constantly.", de:"Ich bin die Mauer, die sie ständig formt.", fa:"من دیوار هستم و آن را دائماً شکل می‌دهم."},

  /* Paths / Roads */
  {stage:1, en:"Somebody has built the road.", de:"Jemand hat die Straße gebaut.", fa:"کسی جاده را ساخته است."},
  {stage:2, en:"Who built the road?", de:"Wer hat die Straße gebaut?", fa:"چه کسی جاده را ساخته است؟"},
  {stage:3, en:"As I walk, the road appears; all is my creation.", de:"Während ich gehe, erscheint die Straße; alles ist meine Schöpfung.", fa:"همان‌طور که راه می‌روم، جاده ظاهر می‌شود؛ همه چیز خلق من است."},

  /* Power / Change */
  {stage:1, en:"I feel powerless to change what happens.", de:"Ich fühle mich machtlos, das Geschehen zu ändern.", fa:"من قدرت تغییر آنچه اتفاق می‌افتد را ندارم."},
  {stage:2, en:"I am the change; I need to act.", de:"Ich bin die Veränderung; ich muss handeln.", fa:"من خود تغییر هستم؛ باید عمل کنم."},
  {stage:3, en:"I hold no resistance; all is perfectly aligned with me.", de:"Ich widerstehe nichts; alles ist perfekt mit mir ausgerichtet.", fa:"من هیچ مقاومتی ندارم؛ همه چیز کاملاً با من هماهنگ است."},

  /* Luck / Fate */
  {stage:1, en:"I believe luck or fate decides outcomes.", de:"Ich glaube, Glück oder Schicksal entscheidet die Ergebnisse.", fa:"من باور دارم شانس یا سرنوشت نتایج را تعیین می‌کند."},
  {stage:2, en:"I trust life more than I resist it.", de:"Ich vertraue dem Leben mehr, als dass ich Widerstand leiste.", fa:"من به زندگی بیشتر از مقاومت اعتماد دارم."},
  {stage:3, en:"I radiate fairness; all outcomes flow through me.", de:"Ich strahle Gerechtigkeit aus; alle Ergebnisse fließen durch mich.", fa:"من عدالت می‌تابانم؛ همه نتایج از طریق من جریان دارند."},

  /* Others / Observations */
  {stage:1, en:"I see others as separate beings on their own journey.", de:"Ich sehe andere als separate Wesen auf ihrem eigenen Weg.", fa:"من دیگران را موجودات جداگانه در مسیر خود می‌بینم."},
  {stage:2, en:"I see others as mirrors, reflecting and teaching me.", de:"Ich sehe andere als Spiegel, die mich reflektieren und lehren.", fa:"من دیگران را به‌عنوان آیینه‌ای می‌بینم که بازتاب می‌دهند و به من آموزش می‌دهند."},
  {stage:3, en:"I see others only as shadows I create; only characters I allow.", de:"Ich sehe andere nur als Schatten, die ich erschaffe; nur Figuren, die ich erlaube.", fa:"من دیگران را تنها به‌عنوان سایه‌هایی که خلق می‌کنم می‌بینم؛ فقط شخصیت‌هایی که اجازه می‌دهم."},

  /* Fear / Control */
  {stage:1, en:"I fear losing control.", de:"Ich habe Angst, die Kontrolle zu verlieren.", fa:"من از دست دادن کنترل می‌ترسم."},
  {stage:2, en:"I see no separation between creation and creator.", de:"Ich sehe keine Trennung zwischen Schöpfung und Schöpfer.", fa:"من جدایی بین خلق و خالق را نمی‌بینم."},
  {stage:3, en:"There are no others; only I experience my creation.", de:"Es gibt keine anderen; nur ich erlebe meine Schöpfung.", fa:"هیچ دیگری وجود ندارد؛ تنها من خلق خود را تجربه می‌کنم."},

  /* Existence / God */
  {stage:1, en:"There is God.", de:"Es gibt Gott.", fa:"خدا وجود دارد."},
  {stage:2, en:"Is there a God?", de:"Gibt es einen Gott?", fa:"آیا خدایی وجود دارد؟"},
  {stage:3, en:"There is no God; only I exist.", de:"Es gibt keinen Gott; nur ich existiere.", fa:"خدایی وجود ندارد؛ تنها من هستم."},

  /* Belonging */
  {stage:1, en:"I need to belong to feel whole.", de:"Ich muss dazugehören, um mich vollständig zu fühlen.", fa:"من نیاز دارم تعلق داشته باشم تا کامل باشم."},
  {stage:2, en:"I am not alone; I belong.", de:"Ich bin nicht allein; ich gehöre dazu.", fa:"من تنها نیستم؛ تعلق دارم."},
  {stage:3, en:"I am alone; the only one.", de:"Ich bin allein; der Einzige.", fa:"من تنها هستم؛ تنها یک موجود."},

  /* Comparison / Reflection */
  {stage:1, en:"I often compare myself to others.", de:"Ich vergleiche mich oft mit anderen.", fa:"من اغلب خود را با دیگران مقایسه می‌کنم."},
  {stage:2, en:"I recognize reflections in others.", de:"Ich erkenne Spiegelungen in anderen.", fa:"من بازتاب‌ها را در دیگران تشخیص می‌دهم."},
  {stage:3, en:"I know love as my natural state.", de:"Ich kenne Liebe als meinen natürlichen Zustand.", fa:"من عشق را به‌عنوان حالت طبیعی خود می‌شناسم."},

  /* Peace / Love */
  {stage:1, en:"I think peace depends on circumstances.", de:"Ich glaube, Frieden hängt von den Umständen ab.", fa:"من فکر می‌کنم صلح به شرایط بستگی دارد."},
  {stage:2, en:"I begin to see love behind appearances.", de:"Ich beginne, Liebe hinter Erscheinungen zu sehen.", fa:"من شروع می‌کنم عشق پشت ظاهرها را ببینم."},
  {stage:3, en:"I am love observing myself.", de:"Ich bin die Liebe, die sich selbst beobachtet.", fa:"من عشقم که خود را مشاهده می‌کند."},

  /* Resentment / Forgiveness */
  {stage:1, en:"I hold resentment or blame.", de:"Ich hege Groll oder Schuldgefühle.", fa:"من دلخوری یا سرزنش دارم."},
  {stage:2, en:"I begin forgiving and letting go.", de:"Ich beginne zu vergeben und loszulassen.", fa:"من شروع می‌کنم به بخشیدن و رها کردن."},
  {stage:3, en:"I understand nothing is missing; all is integrated in me.", de:"Ich verstehe, dass nichts fehlt; alles ist in mir integriert.", fa:"من می‌فهمم هیچ چیزی کم نیست؛ همه چیز در من یکپارچه است."},

  /* Heaven / Hell / Being */
  {stage:1, en:"There is hell and heaven.", de:"Es gibt Himmel und Hölle.", fa:"جهنم و بهشت وجود دارد."},
  {stage:2, en:"Hell and heaven are states of being.", de:"Himmel und Hölle sind Zustände des Seins.", fa:"جهنم و بهشت حالت‌های هستی هستند."},
  {stage:3, en:"There is no hell or heaven; only I experience myself.", de:"Es gibt kein Himmel oder Hölle; nur ich erlebe mich selbst.", fa:"هیچ جهنم یا بهشتی وجود ندارد؛ تنها من خودم را تجربه می‌کنم."},

  /* Blame Awareness */
  {stage:1, en:"There is always someone to blame for events or my experience.", de:"Es gibt immer jemanden, dem man die Schuld geben kann.", fa:"همیشه کسی برای سرزنش وجود دارد."},
  {stage:2, en:"I only blame myself for what I experience.", de:"Ich gebe nur mir selbst die Schuld für das, was ich erlebe.", fa:"من تنها خودم را برای آنچه تجربه می‌کنم سرزنش می‌کنم."},
  {stage:3, en:"I blame no one; all arises from me.", de:"Ich gebe niemandem die Schuld; alles entsteht aus mir.", fa:"من کسی را سرزنش نمی‌کنم؛ همه چیز از من برمی‌خیزد."},

  /* Acknowledgement */
  {stage:1, en:"I need to be acknowledged.", de:"Ich muss anerkannt werden.", fa:"من نیاز دارم که به رسمیت شناخته شوم."},
  {stage:2, en:"I question whether acknowledgement matters.", de:"Ich hinterfrage, ob Anerkennung wichtig ist.", fa:"من می‌پرسم آیا به رسمیت شناختن مهم است؟"},
  {stage:3, en:"I am acknowledgement.", de:"Ich bin Anerkennung.", fa:"من خودم رسمیت هستم."},

  /* Judgment */
  {stage:1, en:"I am constantly judging others.", de:"Ich urteile ständig über andere.", fa:"من مدام دیگران را قضاوت می‌کنم."},
  {stage:2, en:"I try not to judge, but I judge myself.", de:"Ich versuche nicht zu urteilen, aber ich urteile über mich selbst.", fa:"من سعی می‌کنم قضاوت نکنم، اما خودم را قضاوت می‌کنم."},
  {stage:3, en:"There is no judgment.", de:"Es gibt kein Urteil.", fa:"قضاوتی وجود ندارد."}
];

/* stage description text localized */
const STAGE_TEXT = [
  {en:"My consciousness currently aligns with victimhood — experiencing challenges; learning and growth are needed.",
   de:"Mein Bewusstsein stimmt derzeit mit Opferbewusstsein überein — Herausforderungen werden erlebt; Lernen und Wachstum sind notwendig.",
   fa:"آگاهی من در حال حاضر با قربانی بودن هماهنگ است — تجربهٔ چالش‌ها؛ نیاز به یادگیری و رشد وجود دارد."},
  {en:"My consciousness currently aligns with realization — observing patterns, questioning and expanding awareness.",
   de:"Mein Bewusstsein stimmt derzeit mit Erkenntnis überein — Muster werden beobachtet, hinterfragt und das Bewusstsein erweitert.",
   fa:"آگاهی من در حال حاضر با تحقق همسو است — مشاهدهٔ الگوها، پرسشگری و گسترش آگاهی."},
  {en:"My consciousness currently aligns with being — authorship, source-awareness, and deep presence.",
   de:"Mein Bewusstsein stimmt derzeit mit Sein überein — Autorenschaft, Quellenbewusstsein und tiefe Präsenz.",
   fa:"آگاهی من در حال حاضر با هستی همسو است — خالقیت، آگاهی منبع و حضور عمیق."}
];

/* Elements */
const root = document.documentElement;
const pageTitle = document.getElementById('pageTitle');
const langRow = document.getElementById('langRow');
const langSelect = document.getElementById('langSelect');
const landingPane = document.getElementById('landingPane');
const questionPane = document.getElementById('questionPane');
const resultPane = document.getElementById('resultPane');
const startBtn = document.getElementById('startBtn');
const nextBtn = document.getElementById('nextBtn');
const restartBtn = document.getElementById('restartBtn');
const landingText = document.getElementById('landingText');
const landingLabels = {left:document.getElementById('lblLeft'), mid:document.getElementById('lblMid'), right:document.getElementById('lblRight')};
const questionLabels = {left:document.getElementById('qLblLeft'), mid:document.getElementById('qLblMid'), right:document.getElementById('qLblRight')};
const landingSlider = document.getElementById('landingSlider');
const questionSlider = document.getElementById('questionSlider');
const questionText = document.getElementById('questionText');
const scoreI = document.getElementById('scoreI');
const scoreII = document.getElementById('scoreII');
const scoreIII = document.getElementById('scoreIII');
const resultText = document.getElementById('resultText');

let lang = 'en';
let order = [];
let idx = 0;
let answers = []; // array of {stage, value}

/* --- localization helpers --- */
function setRTL(flag){ root.setAttribute('dir', flag ? 'rtl' : 'ltr'); }
function localizeLabels(){
  const map = {
    en: {left:"Disagree", mid:"Uncertain", right:"Agree", start:"Start", next:"Next", restart:"Restart", landingDesc:"This is a reflection of my inner consciousness called Spectrum of Awareness. I am answering a series of statements using the slider to indicate my agreement."},
    de: {left:"Ablehnen", mid:"Ungewiss", right:"Zustimmen", start:"Start", next:"Weiter", restart:"Neu starten", landingDesc:"Dies ist eine Reflexion meines inneren Bewusstseins, genannt Spektrum des Bewusstseins. Ich beantworte eine Reihe von Aussagen mit dem Schieberegler."},
    fa: {left:"مخالف", mid:"نامشخص", right:"موافق", start:"شروع", next:"بعدی", restart:"دوباره", landingDesc:"این بازتاب آگاهی درونی من به نام طیف آگاهی است. من به مجموعه‌ای از جملات پاسخ می‌دهم و با استفاده از نوار لغزنده میزان موافقت را مشخص می‌کنم."}
  }[lang];
  landingLabels.left.textContent = map.left;
  landingLabels.mid.textContent = map.mid;
  landingLabels.right.textContent = map.right;
  questionLabels.left.textContent = map.left;
  questionLabels.mid.textContent = map.mid;
  questionLabels.right.textContent = map.right;
  startBtn.textContent = map.start;
  nextBtn.textContent = map.next;
  restartBtn.textContent = map.restart;
  landingText.textContent = map.landingDesc;
  // update page title localized
  pageTitle.textContent = (lang==='de' ? 'Spektrum des Bewusstseins' : lang==='fa' ? 'طیف آگاهی' : 'Spectrum of Awareness');
}

/* initialize localization */
langSelect.value = lang;
setRTL(false);
localizeLabels();

/* allow language selection only on landing (visible there) */
langSelect.addEventListener('change', (e)=>{
  lang = e.target.value;
  setRTL(lang === 'fa');
  localizeLabels();
});

/* Start - prepare randomized order, hide title & lang row for questionnaire */
startBtn.addEventListener('click', ()=>{
  // hide title & language selector during questionnaire
  pageTitle.style.display = 'none';
  langRow.style.display = 'none';

  // randomize indices
  order = QUESTIONS.map((_,i)=>i).sort(()=>Math.random()-0.5);
  idx = 0;
  answers = [];
  landingPane.classList.add('hidden');
  resultPane.classList.add('hidden');
  questionPane.classList.remove('hidden');
  showQuestion();
});

/* show question at index idx (based on order) */
function showQuestion(){
  const qIdx = order[idx];
  const q = QUESTIONS[qIdx];
  questionText.textContent = q[lang];
  questionSlider.value = 5; // default middle
  questionText.scrollIntoView({behavior:'smooth', block:'center'});
}

/* Next - record answer and advance */
nextBtn.addEventListener('click', ()=>{
  const v = Number(questionSlider.value || 5);
  const qIdx = order[idx];
  answers.push({stage:QUESTIONS[qIdx].stage, value:v});
  idx++;
  if(idx >= order.length){
    // finished
    questionPane.classList.add('hidden');
    // show title on result page (but language selector stays hidden)
    pageTitle.style.display = '';
    resultPane.classList.remove('hidden');
    computeResult();
  } else {
    showQuestion();
  }
});

/* Compute per-stage averages and pick highest */
function computeResult(){
  const sums = [0,0,0];
  const counts = [0,0,0];
  answers.forEach(a=>{
    const s = a.stage - 1; // 0-based
    if(s>=0 && s<3){ sums[s] += a.value; counts[s]++; }
  });
  const avgs = [0,0,0];
  for(let i=0;i<3;i++){ avgs[i] = counts[i] ? (sums[i]/counts[i]) : 0; }

  // Update numeric displays - Roman style Stage I/II/III labels are already visual; show numeric avg
  scoreI.textContent = avgs[0].toFixed(1);
  scoreII.textContent = avgs[1].toFixed(1);
  scoreIII.textContent = avgs[2].toFixed(1);

  // pick highest avg (if tie, highest index - later stage wins)
  let highest = 0;
  if(avgs[1] > avgs[highest]) highest = 1;
  if(avgs[2] > avgs[highest]) highest = 2;

  // localized descriptive result
  resultText.textContent = STAGE_TEXT[highest][lang] || STAGE_TEXT[highest].en;
}

/* Restart -> back to landing (show title & langRow) */
restartBtn.addEventListener('click', ()=>{
  resultPane.classList.add('hidden');
  landingPane.classList.remove('hidden');
  pageTitle.style.display = '';
  langRow.style.display = '';
  landingSlider.value = 5;
  questionSlider.value = 5;
});

/* Accessibility: allow Enter to trigger Next when slider focused? (optional) */
/* Optional: keyboard shortcuts can be added later */

/* Initialize */
landingSlider.value = 5;
questionSlider.value = 5;
</script>
</body>
</html>