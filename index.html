<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Spectrum of Awareness</title>
<style>
  :root{
    --panel-width:760px;
    --accent:#666440;
    --bg:#f5f7fa;
    --card:#ffffff;
    --muted:#666;
    --text:#111;
  }
  html,body{
    height:100%;
    margin:0;
    background:var(--bg);
    font-family:-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    color:var(--text);
  }
  .wrap{
    min-height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
  }
  .panel{
    width:min(96%,var(--panel-width));
    max-width:var(--panel-width);
    background:var(--card);
    border-radius:14px;
    box-shadow:0 10px 30px rgba(20,20,30,0.06);
    padding:34px;
    box-sizing:border-box;
    text-align:center;
  }
  h1{
    margin:0 0 18px 0;
    font-weight:400;
    color:#444;
    font-size:22px;
  }
  .row{
    display:flex;
    justify-content:center;
    gap:12px;
    align-items:center;
    margin-bottom:20px;
  }
  select{
    padding:8px 12px;
    font-size:15px;
    border-radius:8px;
    border:1px solid #e6e6e6;
    background:white;
  }
  p.lead{
    margin:0 0 18px 0;
    color:#666;
    font-size:15px;
    line-height:1.45;
  }
  .fixed-slider-wrap{
    width:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:8px;
    margin:18px 0 8px 0;
  }
  .fixed-track{
    width:92%;
    max-width:680px;
  }
  input[type="range"]{
    -webkit-appearance:none;
    width:100%;
    height:12px;
    border-radius:10px;
    background:#e6e6e6;
    outline:none;
    margin:0;
    padding:0;
  }
  input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none;
    appearance:none;
    width:34px;
    height:18px;
    border-radius:9px;
    background:var(--accent);
    box-shadow:0 6px 18px rgba(102,100,64,0.24);
    border:2px solid white;
    margin-top:-3px;
    cursor:pointer;
  }
  input[type="range"]::-moz-range-thumb{
    width:34px;
    height:18px;
    border-radius:9px;
    background:var(--accent);
    box-shadow:0 6px 18px rgba(102,100,64,0.24);
    border:2px solid white;
    cursor:pointer;
  }
  .slider-labels{
    width:92%;
    max-width:680px;
    display:flex;
    justify-content:space-between;
    color:var(--muted);
    font-size:13px;
    margin-top:6px;
    user-select:none;
  }
  .btn{
    display:inline-block;
    padding:12px 28px;
    border-radius:28px;
    background:var(--accent);
    color:white;
    border:none;
    font-size:15px;
    cursor:pointer;
    box-shadow:0 6px 18px rgba(102,100,64,0.18);
    margin-top:18px;
  }
  .btn:active{
    transform:translateY(1px);
  }
  .hidden{display:none;}
  .result-grid{
    margin-top:12px;
    color:#333;
    font-size:15px;
    display:flex;
    gap:12px;
    justify-content:space-between;
    align-items:center;
  }
  .result-stage{
    font-weight:700;
    flex:1;
    padding:10px;
    background:#fbfbfb;
    border-radius:10px;
    cursor:pointer;
    position:relative;
    transition:background 0.2s;
  }
  .result-stage:hover{
    background:#f0f0f0;
  }
  .result-score{
    font-size:18px;
    color:#222;
    margin-top:8px;
    font-weight:600;
  }
  .stage-desc{
    padding:12px 14px;
    margin-top:8px;
    background:#f9f9f9;
    border-radius:10px;
    text-align:left;
    font-size:14px;
    line-height:1.6;
    display:none;
    white-space:pre-wrap;
  }
  :root[dir="rtl"] .panel{
    direction:rtl;
  }
  :root[dir="rtl"] .slider-labels{
    direction:rtl;
  }
  #questionText{
    font-size:18px;
    line-height:1.45;
    margin:6px 0 14px 0;
    text-align:center;
    word-break:break-word;
  }
  footer.note{
    margin-top:14px;
    color:#666;
    font-size:13px;
  }
  #dominantMessage{
    margin-top:20px;
    background:#f8f8f8;
    border-radius:12px;
    padding:16px;
    color:#333;
    font-size:15px;
    line-height:1.4;
    box-shadow:0 6px 20px rgba(0,0,0,0.04);
  }
  #dominantMessage strong{
    color:var(--accent);
  }
  #overallResult{
    margin-top:20px;
    padding:16px;
    border-radius:16px;
    background:#ffffff;
    box-shadow:0 6px 20px rgba(0,0,0,0.08);
    font-size:16px;
    line-height:1.6;
    text-align:center;
    display:none;
  }
  #overallResult p{
    margin:8px 0;
  }
  @media (max-width:520px){
    .panel{padding:20px;}
    #questionText{font-size:16px;}
    .btn{padding:10px 20px;}
  }
  :root[dir="rtl"] .stage-desc {
    direction: rtl;
    text-align: right;
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="panel" id="panel">

    <!-- Landing Page -->
    <div id="landingPane">
      <h1 id="pageTitle">Spectrum of Awareness</h1>
      <div class="row" id="langRow">
        <select id="langSelect">
          <option value="en">English</option>
          <option value="de">Deutsch</option>
          <option value="fa">فارسی</option>
        </select>
      </div>
      <p class="lead" id="landingText">This is a reflection of my inner consciousness, showing me where my awareness lies in the spectrum of being.</p>
      <button id="startBtn" class="btn">Start</button>
    </div>

    <!-- Questionnaire Page -->
    <div id="questionPane" class="hidden">
      <div id="questionText"></div>
      <div class="fixed-slider-wrap">
        <div class="fixed-track">
          <input id="questionSlider" type="range" min="0" max="10" value="5" />
        </div>
        <div class="slider-labels">
          <span id="qLblLeft">Disagree</span>
          <span id="qLblMid">Uncertain</span>
          <span id="qLblRight">Agree</span>
        </div>
      </div>
      <button id="nextBtn" class="btn">Next</button>
    </div>

    <!-- Result Page -->
    <div id="resultPane" class="hidden">
      <h1 id="resultTitle">Spectrum of Awareness</h1>
      <div class="result-grid">
        <div class="result-stage" id="stageI"><div>Stage I</div><div class="result-score" id="scoreI">0.0</div></div>
        <div class="result-stage" id="stageII"><div>Stage II</div><div class="result-score" id="scoreII">0.0</div></div>
        <div class="result-stage" id="stageIII"><div>Stage III</div><div class="result-score" id="scoreIII">0.0</div></div>
      </div>
      <div id="dominantMessage" class="hidden"></div>
      <div id="stageDetails"></div>
      
      <!-- Final Overall Result -->
      <div id="overallResult"></div>

      <button id="restartBtn" class="btn">Restart</button>
      <footer class="note" id="footerNote"></footer>
    </div>

  </div>
</div>

<script>
// ----------------- QUESTIONS -----------------
const QUESTIONS = [ 
  {stage:1,en:"Life happens to me.",de:"Das Leben passiert mir.",fa:"زندگی برای من اتفاق می‌افتد."},
  {stage:2,en:"Life happens through me.",de:"Das Leben passiert durch mich.",fa:"زندگی از طریق من اتفاق می‌افتد."},
  {stage:3,en:"Life happens as me.",de:"Das Leben passiert als ich.",fa:"زندگی همان من است که رخ می‌دهد."},
  {stage:1,en:"I feel life is unfair or against me.",de:"Ich fühle, das Leben ist unfair oder gegen mich.",fa:"من احساس می‌کنم زندگی ناعادلانه است یا علیه من است."},
  {stage:2,en:"I notice patterns repeating and wonder why.",de:"Ich bemerke sich wiederholende Muster und frage mich warum.",fa:"من الگوهای تکراری را مشاهده می‌کنم و می‌پرسم چرا."},
  {stage:3,en:"I see all as one flow of consciousness.",de:"Ich sehe alles als einen Fluss des Bewusstseins.",fa:"من همه چیز را به‌عنوان یک جریان واحد آگاهی می‌بینم."},
  {stage:1,en:"I am the victim of life.",de:"Ich bin das Opfer des Lebens.",fa:"من قربانی زندگی هستم."},
  {stage:2,en:"I am connected to a source (higher self, God).",de:"Ich bin mit einer Quelle (höheres Selbst, Gott) verbunden.",fa:"من به یک منبع (خود برتر، خدا) متصل هستم."},
  {stage:3,en:"I am the only source; God is a concept within me.",de:"Ich bin die einzige Quelle; Gott ist ein Konzept in mir.",fa:"من تنها منبع هستم؛ خدا مفهومی درون من است."},
];

// ----------------- STAGE SUMMARY -----------------
const STAGE_SUMMARY = {
  1:{en:"I am in Stage I — Victimhood: life feels like it happens to me.",de:"Ich bin in Stufe I — Opferrolle: das Leben scheint mir zu widerfahren.",fa:"من در مرحله اول هستم — قربانی: زندگی را به‌عنوان چیزی که برایم اتفاق می‌افتد تجربه می‌کنم."},
  2:{en:"I am in Stage II — Awakening: life happens through me.",de:"Ich bin in Stufe II — Erwachen: das Leben geschieht durch mich.",fa:"من در مرحله دوم هستم — بیداری: زندگی از طریق من جریان دارد."},
  3:{en:"I am in Stage III — Mastery: life happens as me.",de:"Ich bin in Stufe III — Meisterschaft: das Leben geschieht als ich.",fa:"من در مرحله سوم هستم — تسلط: زندگی همان من است."}
};

// ----------------- OVERALL MESSAGES -----------------
const OVERALL_MESSAGES = {
  en: {
    green: "I am fully aware of who I am, moving with grace and expanding my consciousness.",
    yellow: "I am partially aware, growing and integrating into a version of myself with more possibilities of growth.",
    red: "I am unaware of my core, and I am in the illusion of forgetfulness and separation."
  },
  de: {
    green: "Ich bin mir meiner selbst vollständig bewusst, bewege mich mit Anmut und erweitere mein Bewusstsein.",
    yellow: "Ich bin teilweise bewusst, wachse und integriere mich in eine Version meiner selbst mit mehr Wachstumsmöglichkeiten.",
    red: "Ich bin mir meines Kerns nicht bewusst und lebe in der Illusion des Vergessens und der Trennung."
  },
  fa: {
    green: "من کاملاً از خودم آگاه هستم، با آرامش حرکت می‌کنم و آگاهی‌ام را گسترش می‌دهم.",
    yellow: "من تا حدی آگاه هستم، در حال رشد و یکپارچه شدن به نسخه‌ای از خودم با امکانات بیشتر رشد.",
    red: "من از هسته خود بی‌اطلاعم و در توهم فراموشی و جدایی هستم."
  }
};

// ----------------- LANGUAGE CONTROL -----------------
let currentLang = "en";
const langSelectEl = document.getElementById("langSelect");
langSelectEl.addEventListener("change", (e) => {
  currentLang = e.target.value;
  applyLanguage();
  if(currentQ<QUESTIONS.length && currentQ>=0) showQuestion();
  if(!document.getElementById("resultPane").classList.contains("hidden")) showResults();
});

function applyLanguage(){
  document.documentElement.setAttribute('dir', currentLang === "fa" ? "rtl" : "ltr");
  document.getElementById("pageTitle").textContent = {
    en: "Spectrum of Awareness",
    de: "Spektrum des Bewusstseins",
    fa: "طیف آگاهی"
  }[currentLang];
  document.getElementById("landingText").textContent = {
    en: "This is a reflection of my inner consciousness, showing me where my awareness lies in the spectrum of being.",
    de: "Dies ist eine Reflexion meines inneren Bewusstseins, die mir zeigt, wo mein Bewusstsein im Spektrum des Seins liegt.",
    fa: "این بازتابی از آگاهی درونی من است که نشان می‌دهد آگاهی من در طیف هستی کجا قرار دارد."
  }[currentLang];
  document.getElementById("startBtn").textContent = { en:"Start", de:"Start", fa:"شروع" }[currentLang];
  document.getElementById("nextBtn").textContent = { en:"Next", de:"Weiter", fa:"بعدی" }[currentLang];
  document.getElementById("restartBtn").textContent = { en:"Restart", de:"Neu starten", fa:"شروع دوباره" }[currentLang];
  document.getElementById("qLblLeft").textContent = { en:"Disagree", de:"Stimme nicht zu", fa:"مخالفم" }[currentLang];
  document.getElementById("qLblMid").textContent = { en:"Uncertain", de:"Unsicher", fa:"مطمئن نیستم" }[currentLang];
  document.getElementById("qLblRight").textContent = { en:"Agree", de:"Zustimmen", fa:"موافقم" }[currentLang];
}

// ----------------- SLIDER & QUESTIONS -----------------
let currentQ = 0;
let answers = [];
const questionTextEl = document.getElementById("questionText");
const sliderEl = document.getElementById("questionSlider");
const nextBtnEl = document.getElementById("nextBtn");

function showQuestion(){
  const q = QUESTIONS[currentQ];
  questionTextEl.textContent = q[currentLang];
  sliderEl.value = 5;
}
nextBtnEl.addEventListener("click", ()=>{
  answers.push(parseFloat(sliderEl.value));
  currentQ++;
  if(currentQ >= QUESTIONS.length){
    showResults();
  } else{
    showQuestion();
  }
});

// ----------------- RESULTS CALCULATION -----------------
function showResults(){
  document.getElementById("questionPane").classList.add("hidden");
  document.getElementById("resultPane").classList.remove("hidden");

  const stageScores = {1:[],2:[],3:[]};
  QUESTIONS.forEach((q,i)=>{
    stageScores[q.stage].push(answers[i]);
  });

  const stageAvg = {
    1: average(stageScores[1]),
    2: average(stageScores[2]),
    3: average(stageScores[3])
  };

  document.getElementById("scoreI").textContent = stageAvg[1].toFixed(1);
  document.getElementById("scoreII").textContent = stageAvg[2].toFixed(1);
  document.getElementById("scoreIII").textContent = stageAvg[3].toFixed(1);

  let maxStage = 1;
  if(stageAvg[2]>=stageAvg[maxStage]) maxStage=2;
  if(stageAvg[3]>=stageAvg[maxStage]) maxStage=3;

  const dominantMessageEl = document.getElementById("dominantMessage");
  dominantMessageEl.classList.remove("hidden");
  dominantMessageEl.innerHTML = STAGE_SUMMARY[maxStage][currentLang];

  const detailsEl = document.getElementById("stageDetails");
  detailsEl.innerHTML = "";

  // ----------------- STAGE DETAILS WITH CIRCLES -----------------
  STAGE_INFO.forEach((stage,i)=>{
    const score = stageAvg[i+1];
    const stageDiv = document.createElement("div");
    stageDiv.classList.add("stage-desc");

    const descHTML = stage.description[currentLang].map((line,j)=>{
      if(j===0) return line + "\n\n"; // Stage description line

      let circleColor = "#FFCC33"; // default neutral
      let opacity = 0.3; 
      let bold = false;

      if(line.startsWith("Close to 10:")){
        if(i===0) circleColor = "#FF6B6B";
        if(i===1) circleColor = "#4CAF50";
        if(i===2) circleColor = "#4CAF50";
        if(score>6) { bold=true; opacity=1; }
      } else if(line.startsWith("Around 5:")){
        circleColor = "#FFCC33"; 
        if(score>=4 && score<=6) { bold=true; opacity=1; }
      } else if(line.startsWith("Close to 1:")){
        if(i===0) circleColor = "#4CAF50";
        if(i===1) circleColor = "#FF6B6B";
        if(i===2) circleColor = "#FF6B6B";
        if(score<4) { bold=true; opacity=1; }
      }

      const circleStyle = `display:inline-block;width:18px;height:18px;border-radius:50%;background:${circleColor};margin-right:6px;vertical-align:middle;opacity:${opacity};`;
      return `<span style="${circleStyle}"></span> ${line}`;
    }).join("<br>");
    stageDiv.innerHTML = descHTML;
    detailsEl.appendChild(stageDiv);
  });

  // ----------------- FINAL OVERALL RESULT -----------------
  const finalColor = calculateOverallColor(stageAvg);
  const overallEl = document.getElementById("overallResult");
  overallEl.innerHTML = `
    <div style="display:flex;justify-content:center;gap:10px;margin-bottom:12px;">
      <span style="width:20px;height:20px;border-radius:50%;background:${finalColor};display:inline-block;"></span>
    </div>
    <p>${OVERALL_MESSAGES[currentLang][finalColor==='#4CAF50'?'green':finalColor==='#FFCC33'?'yellow':'red']}</p>
  `;
  overallEl.style.display = "block";
}

function average(arr){
  return arr.reduce((a,b)=>a+b,0)/arr.length;
}

// ----------------- OVERALL COLOR LOGIC -----------------
function calculateOverallColor(stageAvg){
  // If majority stages high=green, mixed=yellow, majority low=red
  let colors = [];
  [1,2,3].forEach(s=>{
    const val = stageAvg[s];
    if(s===1){ colors.push(val>=7?"#FF6B6B":val<=3?"#4CAF50":"#FFCC33"); }
    if(s===2){ colors.push(val>=7?"#4CAF50":val<=3?"#FF6B6B":"#FFCC33"); }
    if(s===3){ colors.push(val>=7?"#4CAF50":val<=3?"#FF6B6B":"#FFCC33"); }
  });

  let green = colors.filter(c=>c==="#4CAF50").length;
  let red = colors.filter(c=>c==="#FF6B6B").length;

  if(green>=2) return "#4CAF50";
  if(red>=2) return "#FF6B6B";
  return "#FFCC33";
}

// ----------------- RESTART -----------------
document.getElementById("restartBtn").addEventListener("click",()=>{
  currentQ=0;
  answers=[];
  document.getElementById("resultPane").classList.add("hidden");
  document.getElementById("landingPane").classList.remove("hidden");
});

// ----------------- START -----------------
document.getElementById("startBtn").addEventListener("click",()=>{
  document.getElementById("landingPane").classList.add("hidden");
  document.getElementById("questionPane").classList.remove("hidden");
  showQuestion();
});

applyLanguage();
</script>
</body>
</html>
